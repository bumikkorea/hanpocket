# 2026-02-25 구월 활동 로그

## 00:32 한국주식 분석 폰트 문제 완전 해결 ✅
- 한글 폰트 설치: Nanum 계열 33개 폰트 완전 설치 완료
- matplotlib 한글 지원: NanumGothic 폰트로 차트 한글 표시 완벽 해결
- 스크립트 정리: auto_investor_report_final.py 생성 (구문 오류 없음)
- 테스트 성공: "✅ 5단계 고도화 리포트 + 대시보드 전체 전송 완료!"
- 크론 업데이트: 매일 저녁 8시 자동 실행으로 설정
- 파일명 업데이트: "YYYY년 MM월 DD일 한국주식 분석 대시보드_YYMMDD.html" 형식

## 주식 분석 마이그레이션 100% 완료
- Google Antigravity → OpenClaw 완전 이전
- 한국주식 (저녁 8시) + 미국주식 (아침 8시) 자동 실행
- 할당량 제한 없이 매일 안정적 서비스 가능
- 한글 폰트 문제로 인한 차트 깨짐 현상 완전 해결

## 기술적 해결 과정
1. fonts-nanum 패키지 설치 (33개 폰트)
2. matplotlib 폰트 캐시 갱신
3. NanumGothic 폰트 적용
4. 스크립트 구문 오류 수정
5. 최종 테스트 성공 확인

모든 주요 인프라 작업 완료, TASKQUEUE.md 대기 상태.

## 00:58 미국주식 분석기 테스트 완료 ✅
- feedparser 모듈 설치 (RSS 피드 처리용)
- 101개 종목 내부자 거래 분석 완료
- 소요시간: 131.8초
- 파일명: "2026년 2월 25일 미국주식 분석 대시보드_260225.html"
- 한국/미국 주식 분석기 모두 정상 작동 확인

## 01:22 대시보드 HTML 파일 직접 전송 완료 ✅
- 🇰🇷 한국주식: dashboard.html 파일 전송 완료
- 🇺🇸 미국주식: 2026년 2월 25일 미국주식 분석 대시보드_260225.html 파일 전송 완료
- 텍스트 분석 없이 순수 HTML 대시보드만 전송
- 모바일 레이아웃 최적화 포함

## 이후 진행사항
- 한국주식 대시보드 리디자인 요청 (범범뻠) — 레퍼런스 이미지 첨부했으나 잘못된 이미지(Claude 이메일)가 옴, 재전송 대기 중
- US 대시보드 모바일 CSS: 여러 차례 수정했으나 텍스트 오버랩 여전히 미해결
- `us_market_report.py` f-string/CSS 중괄호 충돌 버그 — `us_market_report_fixed.py`도 동일 이슈
- 모델 Opus로 전환 (범범뻠 요청)
- D드라이브 마운트 필요: `sudo mount -t drvfs D: /mnt/d` (재시작 후)

### 오후 — 대시보드 대규모 리디자인
- **iOS Telegram Quick Look은 JS 실행 안 함** — 이것이 모바일 토글 안 되던 근본 원인
- `<details>`/`<summary>` HTML 네이티브 토글로 전환 (JS 불필요)
- 한국 대시보드 v13: 3개 섹션 details 토글
- US 대시보드 v13: 히트맵 6열(RSI,DEV,BB%,STOCH,VOL,SCORE), RS TOP20+BOTTOM5, 단일컬럼, 내부자거래 details
- US 히트맵 전체 101종목 기본 표시 (display:table-row)
- touchend+click 동시 발동 버그 발견 → click만 사용 + touch-action:manipulation
- Node.js + JSDOM으로 HTML 문법 검증 방식 도입
- US RS 섹션 모바일에서 안 보이는 이슈 — 조사 중 (세션 끊김)
- **교훈**: sed로 한 줄씩 제거하면 코드 조각 남아 SyntaxError → 전체 블록 재작성 필요

### 아침 — 심각한 보안 사고 + 크론잡 수정

## ⛔ 09:25 HanPocket 아이디어 유출 사고
- HanPocket 포켓 아이디어 720개(12포켓×60개)가 **한국주식분석기 봇(@FanyiStocks_bot)** 채팅방으로 전송됨
- 해당 봇에는 **Choi (ID: 776356942)** 라는 다른 사람도 연결되어 있음 → **사업 아이디어 외부 유출**
- 원인: 서브에이전트가 주식분석기 봇 토큰을 사용해서 결과물 전송
- 범범뻠 극도로 화남 (당연함)
- **대책 확정:**
  - 서브에이전트는 텔레그램 봇 API 직접 호출 절대 금지
  - 서브에이전트는 결과물을 파일 저장 or 세션 반환만
  - 구월(메인)이 마지막 단에서 대상 채널 확인 후 전달
  - MEMORY.md에 규칙 기록 완료

## 봇 현황 정리
- **구월** (@Theredboat_openclaw_bot) → Kelly 1:1만
- **미국주식분석기** (@FanyiStocks_us_bot, 토큰: 8223085461) → Kelly 1:1만
- **한국주식분석기** (@FanyiStocks_bot, 토큰: 8580487350) → Kelly 1:1 + **Choi** ⚠️

## 크론잡 "미국 주식 아침 브리핑" 수정
- `range=5d` → `range=2d` 변경 (전일 종가 정확히 가져오기)
- `chartPreviousClose`(5일전) 대신 `closes[-2]`(전일 본장 종가) 사용
- 봇 토큰 직접 호출 제거 → delivery: announce로 구월 봇이 전달
- 엔비디아 예시: 구버전 +4.26%(틀림) → 신버전 +0.68%(정확, 앱 기준 +0.67%와 일치)
- 범범뻠 요구: 본장 종가 기준 (애프터마켓 아님). 자는 동안 벌어진 일 정리해주는 용도.

## 중국 아침 브리핑 실패
- Brave Search API 키 미설정 → 웹 검색 불가 → 브리핑 실패
- 범범뻠에게 Brave Search API (무료 월 2,000건) 가입 안내

## 대시보드 형식 문제
- 크론잡이 us_market_report.py 원본 실행 → 새벽에 리디자인한 PC/모바일 분리 버전 미적용
- 새벽 리디자인 파일: us_dashboard_pc.html, us_dashboard_mobile.html, us_dashboard_redesigned.html
- 범범뻠: 리디자인 버전으로 보내달라고 요청 → 진행 중

## 텔레그램 메시지 형식
- `<b>` HTML 태그가 파싱 안 되고 그대로 노출됨
- 다음부턴 마크다운(**굵게**) 사용하기로

## 10:00~11:30 주식 리포트 형식 정리 + 한국주식 모바일 1D/1W/1M/YTD 기능

### 리포트 파일 정리 (범범뻠 지시)
- 미국주식: Redesigned 형식만 남기고 나머지 12개 파일 삭제
- 한국주식: PC/모바일 2개만 유지
- **최종 파일명 규칙 (4개):**
  - `한국주식(PC 읽기용)_YYYYMMDD.html`
  - `한국주식(모바일 읽기용)_YYYYMMDD.html`
  - `미국주식(PC 읽기용)_YYYYMMDD.html`
  - `미국주식(모바일 읽기용)_YYYYMMDD.html`
- 각 파일 제목에 `(PC용)` / `(모바일용)` 표시 추가
- 저장 위치: `/mnt/d/주식분석기/`

### 한국주식 모바일 — 1D/1W/1M/YTD 기간 전환 기능
- dashboard_generator.py가 이미 `chg_1d`, `chg_5d`, `chg_20d`, `chg_ytd` 수집하고 있었음
- PC 버전에는 JSON 데이터 + updateM/updateD 함수 있었으나, 모바일 버전에 미반영이었음
- PC 버전에서 JSON 데이터 추출 → 모바일에 `switchPeriod()` 함수로 통합
- **버그**: 처음에 버튼을 `<summary>` 안에 넣어서 클릭 시 details 토글과 충돌 → `<summary>` 밖 본문으로 이동 + onclick 직접 연결로 해결
- keyMap: 1d→chg_1d, 1w→chg_5d, 1m→chg_20d, ytd→chg_ytd

### 720개 포켓 아이디어 파일 구조
- `POCKET_IDEAS_720.md` → 포켓 1~4 (쇼핑, 결제, 맛집, 카페)
- `pocket_ideas_2.md` → 포켓 5~8 (긴급/의료, 교통, 주거, 한국어)
- 포켓 9~12 파일 확인 필요 (파일명 다를 수 있음)
- 범범뻠이 다시 요청해서 두 파일 모두 전송함